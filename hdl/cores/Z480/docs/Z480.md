# Z480 P7 Core (v1)

Z480 is the **P7 native 64-bit tier** in the unified 8080-derived ladder. The v1 core is
an in-order implementation that executes a minimal Z480 ISA subset sufficient for boot
ROM bring-up and device interaction.

## Presentation and discovery

- Presented tier: **P7 (Z480)**.
- Feature bit: **Z480_NATIVE_64**.
- Reset state: privilege = H, PC = `RESET_PC` parameter, MODEFLAGS = STRICT.

## ISA subset (v1)

The current decoder implements a minimal MIPS-like 32-bit encoding. See
`docs/cpu/Z480_ISA.md` for the detailed encoding and instruction list.

Implemented instruction groups:
- Integer ALU: `ADD`, `SUB`, `AND`, `OR`, `XOR`, `ADDI`, `NOP`
- Control flow: `J`, `JAL`, `JR`, `BEQ`, `BNE`
- Loads/stores: `LDB/LDH/LDW/LDD/LDQ`, `STB/STH/STW/STD/STQ`
- CSR access: `CSRR`, `CSRW`
- Fences: `FENCE`, `FENCE_IO` (no-ops in v1)
- Trap return: `RFE`

Unrecognized opcodes trap with `ILLEGAL`.

## Privilege and traps

- Privilege modes: U/S/H (CSR-visible).
- Trap CSRs: `CAUSE`, `EPC`, `BADADDR`, plus per-privilege trap base registers.
- Trap entry selects the next-higher privilege and vectors by IRQ index when applicable.
- `MODEUP/RETMD` instructions are not implemented in-core; they trap with
  `MODEUP_INVALID` and are handled by system-level tier hosting (Option A).

## CSR and CPUID model

`z480_core.sv` exposes the common CSR window:
- `CARBON_CSR_ID`, `CARBON_CSR_TIER`, `CARBON_CSR_MODEFLAGS`
- `CARBON_CSR_TIME/TIME_HI`, `CARBON_CSR_CAUSE/EPC`, `CARBON_CSR_IE/IP`
- `CARBON_CSR_CPUID_*` window for discovery leaves
- Debug mirrors: `CARBON_CSR_DBG_CTRL/DBG_STEP/DBG_STATUS`

Z480-specific CSRs provide trap base and MMU scaffolding registers.

## Memory and I/O ordering

- Fabric I/O is tagged when `(addr & IO_MASK) == IO_BASE`.
- I/O accesses are ordered (no speculative I/O).
- `FENCE`/`FENCE_IO` are accepted but currently act as no-ops.

## What remains TODO

- Expand the ISA (shifts, immediates, atomics, FP/vec).
- Full MMU/TLB implementation and access checks.
- Precise interrupt prioritization and external interrupt controller hooks.
- Performance features (caches, prefetch) that preserve ordered I/O semantics.
